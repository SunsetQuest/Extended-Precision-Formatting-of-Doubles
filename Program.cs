// By Ryan Scott White (Sunsetquest) on 12/6/2020
// Released under the MIT license so feel free to use however you want. Sources are always nice but not required.
// No sources used (Except minor reference lookups)

//Notes: output accurace may not be accurate below with numbers smaller then ~1E-300 (double.Epsilon fails)


using System;
using System.Numerics;

class Program
{
    public static string ToStringFull(double value)
    {
        if (value == 0.0) return "0.0";
        if (double.IsNaN(value)) return "NaN";
        if (double.IsNegativeInfinity(value)) return "-Inf";
        if (double.IsPositiveInfinity(value)) return "+Inf";

        long bits = BitConverter.DoubleToInt64Bits(value);
        BigInteger mantissa = (bits & 0xfffffffffffffL) | 0x10000000000000L;
        int exp = (int)((bits >> 52) & 0x7ffL) - 1023;
        string sign = (value < 0) ? "-" : "";

        if (54 > exp)
        {
            double offset = (exp / 3.321928094887362358); //...or =Math.Log10(Math.Abs(value))
            BigInteger temp = mantissa * BigInteger.Pow(10, 26 - (int)offset) >> (52 - exp);
            string numberText = temp.ToString();
            int digitsNeeded = (int)((numberText[0] - '5') / 10.0 - offset);
            if (exp < 0)
                return sign + "0." + new string('0', digitsNeeded) + numberText;
            else
                return sign + numberText.Insert(1 - digitsNeeded, ".");
        }
        return sign + (mantissa >> (52 - exp)).ToString();
    }

    static void Main(string[] args)
    {
        Console.WriteLine("=================== Just at the mantissa rollover =========================");
        Console.WriteLine(ToStringFull(0.00000000000000044408920985006100));
        Console.WriteLine(ToStringFull(0.00000000000000044408920985006257));
        Console.WriteLine(ToStringFull(0.00000000000000044408920985006400));
        Console.WriteLine(" 3.6893488147419103232E19  0 10001000000 000000000000 00000000 00000000 00000000 00000000 00000000: " + ToStringFull(BitConverter.Int64BitsToDouble(0x4400000000000000)));
        Console.WriteLine(" 3.6893488147419099136E19  0 10000111111 111111111111 11111111 11111111 11111111 11111111 11111111: " + ToStringFull(BitConverter.Int64BitsToDouble(0x43FFFFFFFFFFFFFF)));

        Console.WriteLine("\r\n=================== Just at the Base10 rollover =========================");
        Console.WriteLine("0.0000000000000009999999999998: " + ToStringFull(0.0000000000000009999999999998));
        Console.WriteLine("0.0000000000000009999999999999: " + ToStringFull(0.0000000000000009999999999999));
        Console.WriteLine("0.0000000000000010000000000000: " + ToStringFull(0.0000000000000010000000000000));
        Console.WriteLine("0.0000000000000010000000000001: " + ToStringFull(0.0000000000000010000000000001));

        Console.WriteLine("\r\n=================== Special Numbers =========================");
        Console.WriteLine(ToStringFull(0.0));
        Console.WriteLine("double.NaN:                     " + ToStringFull(double.NaN));
        Console.WriteLine("double.Epsilon + double.Epsilon:" + ToStringFull(double.Epsilon + double.Epsilon) + " [FAILS - should be " + (double.Epsilon + double.Epsilon) + "]");
        Console.WriteLine("double.Epsilon:                 " + ToStringFull(double.Epsilon) + " [FAILS - should be " + double.Epsilon + "]");
        Console.WriteLine("-double.Epsilon:                " + ToStringFull(-double.Epsilon) + " [FAILS - should be " + -double.Epsilon + "]");
        Console.WriteLine("double.MaxValue:                " + ToStringFull(double.MaxValue));
        Console.WriteLine("double.MinValue:                " + ToStringFull(double.MinValue));
        Console.WriteLine("double.NegativeInfinity:        " + ToStringFull(double.NegativeInfinity));
        Console.WriteLine("double.PositiveInfinity:        " + ToStringFull(double.PositiveInfinity));

        Console.WriteLine("\r\n=================== Large range of sizes =========================");
        Console.WriteLine("0.00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000123456789: \r\n" + ToStringFull(0.00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000123456789));
        Console.WriteLine("0.0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000123456789: \r\n" + ToStringFull(0.0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000123456789));
        Console.WriteLine("0.00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000123456789: \r\n" + ToStringFull(0.00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000123456789));
        Console.WriteLine("0.0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000123456789: " + ToStringFull(0.0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000123456789));
        Console.WriteLine("0.00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000123456789: " + ToStringFull(0.00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000123456789));
        Console.WriteLine("0.000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000123456789: " + ToStringFull(0.000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000123456789));
        Console.WriteLine("0.0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000123456789: " + ToStringFull(0.0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000123456789));
        Console.WriteLine("0.00000000000000000000000000000000000000000000000000000000000000000000000000000000000000123456789: " + ToStringFull(0.00000000000000000000000000000000000000000000000000000000000000000000000000000000000000123456789));
        Console.WriteLine("0.000000000000000000000000000000000000000000000000000000000000000000000000000000000123456789: " + ToStringFull(0.000000000000000000000000000000000000000000000000000000000000000000000000000000000123456789));
        Console.WriteLine("0.0000000000000000000000000000000000000000000000000000000000000000000000000000123456789: " + ToStringFull(0.0000000000000000000000000000000000000000000000000000000000000000000000000000123456789));
        Console.WriteLine("0.00000000000000000000000000000000000000000000000000000000000000000000000123456789: " + ToStringFull(0.00000000000000000000000000000000000000000000000000000000000000000000000123456789));
        Console.WriteLine("0.000000000000000000000000000000000000000000000000000000000000000000123456789: " + ToStringFull(0.000000000000000000000000000000000000000000000000000000000000000000123456789));
        Console.WriteLine("0.0000000000000000000000000000000000000000000000000000000000000123456789: " + ToStringFull(0.0000000000000000000000000000000000000000000000000000000000000123456789));
        Console.WriteLine("0.00000000000000000000000000000000000000000000000000000000123456789: " + ToStringFull(0.00000000000000000000000000000000000000000000000000000000123456789));
        Console.WriteLine("0.000000000000000000000000000000000000000000000000000123456789: " + ToStringFull(0.000000000000000000000000000000000000000000000000000123456789));
        Console.WriteLine("0.0000000000000000000000000000000000000000000000123456789: " + ToStringFull(0.0000000000000000000000000000000000000000000000123456789));
        Console.WriteLine("0.00000000000000000000000000000000000000000123456789: " + ToStringFull(0.00000000000000000000000000000000000000000123456789));
        Console.WriteLine("0.000000000000000000000000000000000000123456789: " + ToStringFull(0.000000000000000000000000000000000000123456789));
        Console.WriteLine("0.00000000000000000000000000000000000123: " + ToStringFull(0.00000000000000000000000000000000000123));
        Console.WriteLine("0.0000000000000000000000000000000000123: " + ToStringFull(0.0000000000000000000000000000000000123));
        Console.WriteLine("0.000000000000000000000000000000000123: " + ToStringFull(0.000000000000000000000000000000000123));
        Console.WriteLine("0.00000000000000000000000000000000123: " + ToStringFull(0.00000000000000000000000000000000123));
        Console.WriteLine("0.0000000000000000000000000000000123: " + ToStringFull(0.0000000000000000000000000000000123));
        Console.WriteLine("0.000000000000000000000000000000123: " + ToStringFull(0.000000000000000000000000000000123));
        Console.WriteLine("0.00000000000000000000000000000123: " + ToStringFull(0.00000000000000000000000000000123));
        Console.WriteLine("0.0000000000000000000000000000123: " + ToStringFull(0.0000000000000000000000000000123));
        Console.WriteLine("0.000000000000000000000000000123: " + ToStringFull(0.000000000000000000000000000123));
        Console.WriteLine("0.00000000000000000000000000123: " + ToStringFull(0.00000000000000000000000000123));
        Console.WriteLine("0.0000000000000000000000000123: " + ToStringFull(0.0000000000000000000000000123));
        Console.WriteLine("0.000000000000000000000000123: " + ToStringFull(0.000000000000000000000000123));
        Console.WriteLine("0.00000000000000000000000123: " + ToStringFull(0.00000000000000000000000123));
        Console.WriteLine("0.0000000000000000000000123: " + ToStringFull(0.0000000000000000000000123));
        Console.WriteLine("0.000000000000000000000123: " + ToStringFull(0.000000000000000000000123));
        Console.WriteLine("0.00000000000000000000123: " + ToStringFull(0.00000000000000000000123));
        Console.WriteLine("0.0000000000000000000123: " + ToStringFull(0.0000000000000000000123));
        Console.WriteLine("0.000000000000000000123: " + ToStringFull(0.000000000000000000123));
        Console.WriteLine("0.00000000000000000123: " + ToStringFull(0.00000000000000000123));
        Console.WriteLine("0.0000000000000000123: " + ToStringFull(0.0000000000000000123));
        Console.WriteLine("0.000000000000000123: " + ToStringFull(0.000000000000000123));
        Console.WriteLine("0.00000000000000123: " + ToStringFull(0.00000000000000123));
        Console.WriteLine("0.0000000000000123: " + ToStringFull(0.0000000000000123));
        Console.WriteLine("0.000000000000123: " + ToStringFull(0.000000000000123));
        Console.WriteLine("0.00000000000123: " + ToStringFull(0.00000000000123));
        Console.WriteLine("0.0000000000123: " + ToStringFull(0.0000000000123));
        Console.WriteLine("0.000000000123: " + ToStringFull(0.000000000123));
        Console.WriteLine("0.00000000123: " + ToStringFull(0.00000000123));
        Console.WriteLine("0.0000000123: " + ToStringFull(0.0000000123));
        Console.WriteLine("0.000000123: " + ToStringFull(0.000000123));
        Console.WriteLine("0.00000123: " + ToStringFull(0.00000123));
        Console.WriteLine("0.0000123: " + ToStringFull(0.0000123));
        Console.WriteLine("0.000123: " + ToStringFull(0.000123));
        Console.WriteLine("0.00123: " + ToStringFull(0.00123));
        Console.WriteLine("0.0123: " + ToStringFull(0.0123));
        Console.WriteLine("0.123: " + ToStringFull(0.123));
        Console.WriteLine("1.23: " + ToStringFull(1.23));
        Console.WriteLine("12.3: " + ToStringFull(12.3));
        Console.WriteLine("123.0: " + ToStringFull(123.0));
        Console.WriteLine("1230.0: " + ToStringFull(1230.0));
        Console.WriteLine("12300.0: " + ToStringFull(12300.0));
        Console.WriteLine("123000.0: " + ToStringFull(123000.0));
        Console.WriteLine("1230000.0: " + ToStringFull(1230000.0));
        Console.WriteLine("12300000.0: " + ToStringFull(12300000.0));
        Console.WriteLine("123000000.0: " + ToStringFull(123000000.0));
        Console.WriteLine("1230000000.0: " + ToStringFull(1230000000.0));
        Console.WriteLine("12300000000.0: " + ToStringFull(12300000000.0));
        Console.WriteLine("123000000000.0: " + ToStringFull(123000000000.0));
        Console.WriteLine("1230000000000.0: " + ToStringFull(1230000000000.0));
        Console.WriteLine("12300000000000.0: " + ToStringFull(12300000000000.0));
        Console.WriteLine("123000000000000.0: " + ToStringFull(123000000000000.0));
        Console.WriteLine("1230000000000000.0: " + ToStringFull(1230000000000000.0));
        Console.WriteLine("12300000000000000.0: " + ToStringFull(12300000000000000.0));
        Console.WriteLine("123000000000000000.0: " + ToStringFull(123000000000000000.0));
        Console.WriteLine("1230000000000000000.0: " + ToStringFull(1230000000000000000.0));
        Console.WriteLine("12300000000000000000.0: " + ToStringFull(12300000000000000000.0));
        Console.WriteLine("123000000000000000000.0: " + ToStringFull(123000000000000000000.0));
        Console.WriteLine("1230000000000000000000.0: " + ToStringFull(1230000000000000000000.0));
        Console.WriteLine("12300000000000000000000.0: " + ToStringFull(12300000000000000000000.0));
        Console.WriteLine("123000000000000000000000.0: " + ToStringFull(123000000000000000000000.0));
        Console.WriteLine("1230000000000000000000000.0: " + ToStringFull(1230000000000000000000000.0));
        Console.WriteLine("12300000000000000000000000.0: " + ToStringFull(12300000000000000000000000.0));
        Console.WriteLine("123000000000000000000000000.0: " + ToStringFull(123000000000000000000000000.0));
        Console.WriteLine("1230000000000000000000000000.0: " + ToStringFull(1230000000000000000000000000.0));
        Console.WriteLine("12300000000000000000000000000.0: " + ToStringFull(12300000000000000000000000000.0));
        Console.WriteLine("123000000000000000000000000000.0: " + ToStringFull(123000000000000000000000000000.0));
        Console.WriteLine("1230000000000000000000000000000.0: " + ToStringFull(1230000000000000000000000000000.0));
        Console.WriteLine("12300000000000000000000000000000.0: " + ToStringFull(12300000000000000000000000000000.0));
        Console.WriteLine("123000000000000000000000000000000.0: " + ToStringFull(123000000000000000000000000000000.0));
        Console.WriteLine("1230000000000000000000000000000000.0: " + ToStringFull(1230000000000000000000000000000000.0));
        Console.WriteLine("12300000000000000000000000000000000.0: " + ToStringFull(12300000000000000000000000000000000.0));
        Console.WriteLine("123000000000000000000000000000000000.0: " + ToStringFull(123000000000000000000000000000000000.0));
        Console.WriteLine("1230000000000000000000000000000000000.0: " + ToStringFull(1230000000000000000000000000000000000.0));
        Console.WriteLine("12300000000000000000000000000000000000.0: " + ToStringFull(12300000000000000000000000000000000000.0));
        Console.WriteLine("123000000000000000000000000000000000000.0: " + ToStringFull(123000000000000000000000000000000000000.0));
        Console.WriteLine("1230000000000000000000000000000000000000.0: " + ToStringFull(1230000000000000000000000000000000000000.0));
        Console.WriteLine("12300000000000000000000000000000000000000.0: " + ToStringFull(12300000000000000000000000000000000000000.0));
            
        Console.WriteLine("\r\n=================== Large range of sizes =========================");
        Console.WriteLine("12300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000: \r\n" + ToStringFull(12300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000.0));
        Console.WriteLine("-12300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000: \r\n" + ToStringFull(-12300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000.0));

        Console.WriteLine("\r\n=================== Other =========================");
        double i = (10 * 0.69);
        Console.WriteLine("(10 * 0.69): " + ToStringFull(i));
        Console.WriteLine("-6.9: " + ToStringFull(-6.9));
        Console.WriteLine("(10 * 0.69)-6.9: " + ToStringFull(i - 6.9));
    }
}

